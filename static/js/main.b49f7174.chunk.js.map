{"version":3,"sources":["components/Selector.js","service/_config.js","service/getData.js","App.js","index.js"],"names":["Selector","label","options","data","setData","setData2","setdirection","FormControl","size","fullWidth","error","InputLabel","id","Select","labelId","value","onChange","e","routeName","target","filter","x","RouteName","Zh_tw","map","item","index","MenuItem","City","CityName","getAuthorizationHeader","GMTString","Date","toGMTString","ShaObj","jsSHA","setHMACKey","update","getHMAC","getPromise","url","a","axios","method","headers","App","React","useState","city","setcity","routes","setroutes","route","setroute","routeData","setrouteData","direction","stopsData","setstopsData","estimatedTime","setestimatedTime","useEffect","then","res","length","sort","b","localeCompare","catch","err","console","log","getBusRouteByCity","RouteUID","setdata","routeUID","getStopOfRoute","getEstimatedTime","directionButton","str","dir","href","style","display","textDecoration","width","color","fontWeight","onClick","preventDefault","maxWidth","padding","Box","mb","Cities","mr","borderRadius","boxShadow","className","borderBottomLeftRadius","borderBottomRightRadius","RouteMapImageUrl","rel","marginLeft","textAlign","DepartureStopNameZh","Divider","orientation","borderColor","flexItem","DestinationStopNameZh","Direction","Stops","stop","margin","some","StopUID","CurrentStop","PlateNumb","y","EstimateTime","toFixed","fontSize","StopName","light","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.b49f7174.chunk.js","sourcesContent":["import React from 'react';\r\n// MUI\r\nimport InputLabel from '@mui/material/InputLabel';\r\nimport MenuItem from '@mui/material/MenuItem';\r\nimport FormControl from '@mui/material/FormControl';\r\nimport Select from '@mui/material/Select';\r\n//-------------------\r\nexport default function Selector({ label, options, data, setData, setData2, setdirection }) {\r\n    const handleChange = e => {\r\n        const routeName = e.target.value\r\n        setData(routeName);\r\n        if (label === \"縣市\") {\r\n            setData2(\"\")\r\n        }\r\n        if (label === \"路線\") {\r\n            setData2(options.filter(x => (x.RouteName && x.RouteName.Zh_tw) === routeName)[0])\r\n            setdirection(0)\r\n        }\r\n    };\r\n\r\n    return (\r\n        <FormControl size=\"small\" fullWidth error={false}>\r\n            <InputLabel id=\"demo-simple-select-label\">{label}</InputLabel>\r\n            <Select\r\n                labelId=\"demo-simple-select-label\"\r\n                id=\"demo-simple-select\"\r\n                value={data}\r\n                label=\"label\"\r\n                onChange={handleChange}\r\n            >{options && options.map((item, index) => (\r\n                <MenuItem key={index} value={(item.RouteName && item.RouteName.Zh_tw) || item.City}>{(item.RouteName && item.RouteName.Zh_tw) || item.CityName}</MenuItem>\r\n            ))}</Select>\r\n        </FormControl >\r\n    );\r\n}\r\n","import jsSHA from 'jssha'\r\n//--------------------\r\nexport function getAuthorizationHeader() {\r\n  let AppID = '125f67eef61d44189819c6378e4da9cb';\r\n  let AppKey = 'Pn9PITNbREc7_yBevt-7udS0UOE';\r\n  let GMTString = new Date().toGMTString();\r\n  let ShaObj = new jsSHA('SHA-1', 'TEXT');\r\n  ShaObj.setHMACKey(AppKey, 'TEXT');\r\n  ShaObj.update('x-date: ' + GMTString);\r\n  let HMAC = ShaObj.getHMAC('B64');\r\n  let Authorization = 'hmac username=\"' + AppID + '\", algorithm=\"hmac-sha1\", headers=\"x-date\", signature=\"' + HMAC + '\"';\r\n  return { 'Authorization': Authorization, 'X-Date': GMTString };\r\n}","import axios from 'axios'\r\nimport { getAuthorizationHeader } from 'src/service/_config'\r\n//--------------------\r\nfunction getPromise(url) {\r\n    return (async () => await axios({\r\n        method: 'get',\r\n        url: url,\r\n        headers: getAuthorizationHeader()\r\n    }))()\r\n}\r\n\r\nexport function getBusRouteByCity(setData, city) {\r\n    getPromise(`https://ptx.transportdata.tw/MOTC/v2/Bus/Route/City/${city}?$format=JSON`)\r\n        .then(res => {\r\n            if (res.data.length > 0)\r\n                setData(res.data.sort((a, b) => ('' + a.RouteName.Zh_tw).localeCompare(b.RouteName.Zh_tw)))\r\n        }).catch(err => console.log(err))\r\n}\r\n\r\nexport function getStopOfRoute(setdata, city, routeName, routeUID) {\r\n    getPromise(`https://ptx.transportdata.tw/MOTC/v2/Bus/StopOfRoute/City/${city}/${routeName}?$filter=RouteUID%20eq%20'${routeUID}'&$top=30&$format=JSON`)\r\n        .then(res => {\r\n            if (res.data.length > 0)\r\n                setdata(res.data)\r\n        }).catch(err => console.log(err))\r\n}\r\n\r\nexport function getEstimatedTime(setdata, city, routeName, routeUID) {\r\n    getPromise(`https://ptx.transportdata.tw/MOTC/v2/Bus/EstimatedTimeOfArrival/City/${city}/${routeName}?$filter=RouteUID%20eq%20'${routeUID}'&$top=100&$format=JSON`)\r\n        .then(res => {\r\n            if (res.data.length > 0)\r\n                setdata(res.data)\r\n        }).catch(err => console.log(err))\r\n}","import React from 'react';\r\n// MUI\r\nimport Box from '@mui/material/Box';\r\nimport Divider from '@mui/material/Divider';\r\nimport InfoIcon from '@mui/icons-material/Info';\r\n// Custom\r\nimport 'src/_global.scss'\r\nimport Selector from 'src/components/Selector';\r\nimport Cities from 'src/service/cities.json'\r\nimport { getBusRouteByCity, getStopOfRoute, getEstimatedTime } from 'src/service/getData'\r\n//-------------------\r\nfunction App() {\r\n  const [city, setcity] = React.useState(\"\");\r\n  const [routes, setroutes] = React.useState();\r\n  const [route, setroute] = React.useState(\"\");\r\n  const [routeData, setrouteData] = React.useState();\r\n  const [direction, setdirection] = React.useState(0);\r\n  const [stopsData, setstopsData] = React.useState();\r\n  const [estimatedTime, setestimatedTime] = React.useState();\r\n\r\n  React.useEffect(() => {\r\n    if (city) {\r\n      getBusRouteByCity(setroutes, city);\r\n    }\r\n    if (city && routeData && routeData.RouteName.Zh_tw && routeData.RouteUID) {\r\n      getStopOfRoute(setstopsData, city, routeData.RouteName.Zh_tw, routeData.RouteUID)\r\n      getEstimatedTime(setestimatedTime, city, routeData.RouteName.Zh_tw, routeData.RouteUID)\r\n    }\r\n  }, [setroutes, city, routeData]);\r\n\r\n  const directionButton = (str, dir) => (\r\n    <a href=\"/\"\r\n      style={{\r\n        display: 'block',\r\n        textDecoration: 'none',\r\n        width: '50%',\r\n        color: dir === direction ? '#fff' : '#000',\r\n        fontWeight: dir === direction ? 'bold' : 'normal'\r\n      }}\r\n      onClick={e => {\r\n        e.preventDefault()\r\n        setdirection(dir)\r\n      }}\r\n    > 往 {str}</a >\r\n  )\r\n\r\n  return (\r\n    <div style={{ maxWidth: '400px', padding: '12px 20px' }}>\r\n      <Box display=\"flex\" mb={1}>\r\n        <Selector label=\"縣市\" options={Cities} data={city} setData={setcity} setData2={setroute} />\r\n        {routes &&\r\n          <>\r\n            <Box mr={1} />\r\n            <Selector label=\"路線\" options={routes} data={route} setData={setroute} setData2={setrouteData} setdirection={setdirection} />\r\n          </>\r\n        }\r\n      </Box>\r\n      {routeData &&\r\n        <Box borderRadius={2} boxShadow={3}>\r\n          {/* Selector */}\r\n          <Box borderRadius={2} display=\"flex\" className=\"bg-primary300\" style={{ color: '#fff', padding: '16px 32px', borderBottomLeftRadius: '0', borderBottomRightRadius: '0' }}>\r\n            <h2 style={{ width: '100%' }}>{routeData.RouteName.Zh_tw}</h2>\r\n            <a href={routeData.RouteMapImageUrl} target=\"_blank\" rel=\"noreferrer\" style={{ display: 'block', marginLeft: 'auto', color: '#fff' }} ><InfoIcon /></a>\r\n          </Box>\r\n          {/* Direction */}\r\n          <Box className=\"bg-primary200\" display=\"flex\" style={{ padding: '8px 0', textAlign: 'center' }}>\r\n            {directionButton(routeData.DepartureStopNameZh, 0)}\r\n            <Divider orientation=\"vertical\" style={{ borderColor: '#fff' }} flexItem />\r\n            {directionButton(routeData.DestinationStopNameZh, 1)}\r\n          </Box>\r\n          {/* EstimatedTime */}\r\n          <Box style={{ padding: '8px 20px' }}>\r\n            {stopsData && stopsData.map((item, index) =>\r\n              item.Direction === direction &&\r\n              <Box key={index}>\r\n                {item.Stops.map((stop, index) => (\r\n                  <Box key={stop.StopUID}>\r\n                    <Box display=\"flex\" style={{ padding: '8px 0' }}>\r\n                      <Box borderRadius={2} display=\"flex\" className=\"border-primary400\">\r\n                        <p className=\"primary400\" style={{ width: '60px', textAlign: 'center', margin: 'auto 0', padding: '4px 0' }}>\r\n                          {estimatedTime && estimatedTime.some(x => x.StopUID === stop.StopUID) && estimatedTime\r\n                            .filter(x => x.CurrentStop !== \"-1\" && x.PlateNumb !== \"-1\" && x.StopUID === stop.StopUID)\r\n                            .sort((x, y) => x.EstimateTime - y.EstimateTime)\r\n                            .map(item => (item && item.EstimateTime) ?\r\n                              <span>{`${(item.EstimateTime / 60).toFixed(0)}分`}</span>\r\n                              : <span style={{ fontSize: '10px' }}>尚未到站</span>\r\n                            )\r\n                          }\r\n                        </p>\r\n                      </Box>\r\n                      <p style={{ margin: 'auto 0 auto 8px', fontWeight: 'bold' }}>{stop.StopName.Zh_tw}</p>\r\n                    </Box>\r\n                    <Divider light />\r\n                  </Box>\r\n                ))}\r\n              </Box>\r\n            )}\r\n          </Box>\r\n        </Box>\r\n      }\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from './App';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);"],"sourceRoot":""}